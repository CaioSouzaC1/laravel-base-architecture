<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>websocket</title>
        
    </head>
    <body style="background-color: black; color: white">
        <h1>websocket</h1>
        <div id="productContainer"></div>
        <button id="ws">Bot達o</button>
        <script>
            const socket = new WebSocket("ws://127.0.0.1:6001/app/app-key");
            console.log(socket);
            socket.onopen = function (event) {
                console.log("Conex達o estabelecida com o servidor");
            };

            socket.onmessage = function (event) {
                console.log(event);
                const data = JSON.parse(event.data);
                if (data.event === "products.store") {
                    const productContainer =
                        document.querySelector("#productContainer");
                    productContainer.innerHTML += `<div>${data.data.name}</div>`;
                }
            };

            socket.onerror = function (error) {
                console.log("Erro na conex達o:");
                console.error(error);
            };

            socket.onclose = function (event) {
                console.log("Conex達o fechada");
            };

            const ws = document.getElementById("ws");
            ws.addEventListener("click", () => {
                const dataToSend = JSON.stringify({
                    channel: "products-channel",
                    event: "products.store",
                    data: {
                        name: "Nome do Produto",
                        price: 10.99,
                    },
                });
                socket.send(dataToSend);
            });
        </script>

    </body>
</html>
